<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dashboard ‚Äî TI-Verde</title>
  <meta name="description" content="Dashboard interativo com resultados da pesquisa TI-Verde (3 empresas reais + 17 participantes). Atualize os dados conforme evid√™ncias coletadas."/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <link rel="stylesheet" href="style.css">
  <style>
    body { background:#f7fbf7; }
    .card-hero { border-left:4px solid #198754; background:#ffffff; padding:18px; border-radius:8px; }
    .kpi { background:#f0fff4; border:1px solid #e4f6e8; padding:12px; border-radius:6px; }
    .table-wrap { max-height:300px; overflow:auto; }
    canvas { background:#fff; border-radius:6px; padding:12px; box-shadow:0 1px 4px rgba(0,0,0,0.04); }
    .small-note { font-size:0.9rem; color:#436b3b; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-success">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">üåø TI-Verde</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menuNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="menuNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">In√≠cio</a></li>
          <li class="nav-item"><a class="nav-link" href="eficiencia.html">Efici√™ncia</a></li>
          <li class="nav-item"><a class="nav-link" href="e-lixo.html">E-lixo</a></li>
          <li class="nav-item"><a class="nav-link" href="cloud.html">Cloud</a></li>
          <li class="nav-item"><a class="nav-link" href="ods12.html">ODS 12</a></li>
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="dashboard.html">Dashboard</a></li>
          <li class="nav-item"><a class="nav-link" href="sobre.html">Sobre</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <div class="card card-hero mb-4">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="h4 text-success mb-1">Dashboard ‚Äî Resultados da Pesquisa (TI-Verde)</h1>
          <p class="mb-0 small-note">Dados: 3 empresas reais (ex.: AWS, Microsoft Azure, Google Cloud) + 17 participantes do p√∫blico. Substitua os valores de consumo por n√∫meros oficiais quando obt√™-los ‚Äî mantenha evid√™ncias (e-mails/prints) para o relat√≥rio.</p>
        </div>
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
          <a href="cloud.html" class="btn btn-outline-success btn-sm">Voltar √† p√°gina Cloud</a>
          <button id="downloadCsvBtn" class="btn btn-success btn-sm">Baixar CSV (exemplo)</button>
        </div>
      </div>
    </div>

    <!-- KPIs r√°pidos -->
    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="kpi">
          <h6 class="mb-1">Empresas analisadas</h6>
          <strong id="kpiEmpresas">3</strong>
        </div>
      </div>
      <div class="col-md-4">
        <div class="kpi">
          <h6 class="mb-1">Participantes (p√∫blico)</h6>
          <strong id="kpiPessoas">17</strong>
        </div>
      </div>
      <div class="col-md-4">
        <div class="kpi">
          <h6 class="mb-1">Indicador de conscientiza√ß√£o</h6>
          <strong id="kpiConsc">‚Äî</strong>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Gr√°ficos -->
      <div class="col-lg-8">
        <div class="row g-4">
          <div class="col-12">
            <div class="card p-3">
              <h6 class="text-success mb-3">Consumo de energia (kWh) ‚Äî empresas</h6>
              <canvas id="graficoEmpresas" height="120"></canvas>
              <div class="small-note mt-2">Observa√ß√£o: valores preenchidos como exemplo/estimativa. Substitua com dados oficiais das empresas (se autorizado).</div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card p-3">
              <h6 class="text-success mb-3">Conscientiza√ß√£o sobre Cloud Sustent√°vel (pessoas)</h6>
              <canvas id="graficoPessoas" height="160"></canvas>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card p-3">
              <h6 class="text-success mb-3">Formas de descarte (p√∫blico)</h6>
              <canvas id="graficoDescarte" height="160"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Resumo / Tabela -->
      <div class="col-lg-4">
        <div class="card p-3 mb-3">
          <h6 class="text-success">Resumo ‚Äî Empresas</h6>
          <div class="table-wrap mt-2">
            <table class="table table-sm" id="resumoEmpresas">
              <!-- preenchido via JS -->
            </table>
          </div>
          <div class="mt-3">
            <small class="text-muted">As colunas mostram kWh (m√™s/√°rea de TI, quando informado), virtualiza√ß√£o e medidas relatadas.</small>
          </div>
        </div>

        <div class="card p-3">
          <h6 class="text-success">A√ß√µes sugeridas</h6>
          <ul class="mb-0">
            <li>Solicitar √†s empresas consumo (kWh) da √°rea de TI / servidor.</li>
            <li>Coletar autoriza√ß√µes por escrito para uso do nome p√∫blica.</li>
            <li>Documentar todas as intera√ß√µes (e-mails, prints, formul√°rios).</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Tabela completa de dados (ocult√°vel) -->
    <section class="mt-4">
      <div class="card p-3">
        <div class="d-flex justify-content-between align-items-center">
          <h6 class="text-success mb-0">Dados brutos (exemplo) ‚Äî editar conforme evid√™ncias</h6>
          <button id="toggleRawBtn" class="btn btn-sm btn-outline-secondary">Mostrar/Ocultar</button>
        </div>
        <div id="rawData" class="mt-3" style="display:none">
          <div class="table-responsive">
            <table class="table table-sm table-bordered" id="tableRaw">
              <!-- preenchido via JS -->
            </table>
          </div>
        </div>
        <div class="mt-2 small-note">N√£o publique dados individuais sem consentimento; prefira vers√µes agregadas no relat√≥rio.</div>
      </div>
    </section>

  </main>

  <footer class="bg-success text-white py-3 mt-4">
    <div class="container d-flex justify-content-between">
      <div>TI-Verde ‚Äî Dashboard</div>
      <div><a href="https://github.com/allanaismerio" target="_blank" class="text-white">GitHub</a></div>
    </div>
  </footer>

  <!-- CSV embutido atualizado -->
  <script>
    const exemploCSV = `tipo_respondente,empresa_nome,resposta_id,data,idade,descarte,conhecimento_cloud,energia_kwh,virtualizacao,medidas_eficiencia,autorizacao,observacoes
empresa,Amazon Web Services (AWS),E01,2025-09-30,,,,1200,Sim,"Virtualiza√ß√£o, efici√™ncia de data centers",Sim,"Fonte: relat√≥rios p√∫blicos"
empresa,Microsoft Azure,E02,2025-09-30,,,,900,Sim,"Contratos de energia renov√°vel, PUE otimizado",Sim,"Fonte: relat√≥rios p√∫blicos"
empresa,Google Cloud,E03,2025-09-30,,,,450,Sim,"Compra de energia renov√°vel, design de data centers",Sim,"Fonte: relat√≥rios p√∫blicos"
pessoa,,P01,2025-10-01,21,N√£o,N√£o,,,,Sim,camilla
pessoa,,P02,2025-10-01,21,N√£o,N√£o,,,,Sim,clara
pessoa,,P03,2025-10-02,22,N√£o,N√£o,,,,Sim,raphael
pessoa,,P04,2025-10-02,50,N√£o,N√£o,,,,Sim,ana paula
pessoa,,P05,2025-10-03,57,N√£o,N√£o,,,,Sim,celio
pessoa,,P06,2025-10-03,27,N√£o,N√£o,,,,Sim,celiane
pessoa,,P07,2025-10-04,23,N√£o,N√£o,,,,Sim,jayana
pessoa,,P08,2025-10-04,26,N√£o,N√£o,,,,Sim,jessica
pessoa,,P09,2025-10-05,28,N√£o,N√£o,,,,Sim,fabio
pessoa,,P10,2025-10-05,21,N√£o,N√£o,,,,Sim,nicoly
pessoa,,P11,2025-10-06,22,N√£o,N√£o,,,,Sim,kaio
pessoa,,P12,2025-10-06,50,N√£o,N√£o,,,,Sim,sheila
pessoa,,P13,2025-10-07,24,N√£o,N√£o,,,,Sim,victoria
pessoa,,P14,2025-10-07,19,N√£o,N√£o,,,,Sim,guilherme
pessoa,,P15,2025-10-08,49,N√£o,N√£o,,,,Sim,daniela
pessoa,,P16,2025-10-08,52,N√£o,N√£o,,,,Sim,gilmar
pessoa,,P17,2025-10-09,17,N√£o,N√£o,,,,Sim,ana
`;
  </script>

  <script>
    function formatoValor(v){
      if(v === null || v === undefined || v === "" ) return "N√£o informado";
      if(!isNaN(Number(v))) return Number(v).toLocaleString();
      return v;
    }

    function initDashboardFromCSVString(csvString){
      Papa.parse(csvString, {
        header: true,
        skipEmptyLines: true,
        complete: function(results){
          renderDashboard(results.data);
        }
      });
    }

    function renderDashboard(rows){
      const empresas = rows.filter(r => r.tipo_respondente && r.tipo_respondente.toLowerCase() === 'empresa');
      const pessoas = rows.filter(r => r.tipo_respondente && r.tipo_respondente.toLowerCase() === 'pessoa');

      document.getElementById('kpiEmpresas').innerText = empresas.length;
      document.getElementById('kpiPessoas').innerText = pessoas.length;

      const conhece = pessoas.reduce((acc, p) => acc + ((p.conhecimento_cloud && p.conhecimento_cloud.toString().toLowerCase().startsWith('s')) ? 1 : 0), 0);
      document.getElementById('kpiConsc').innerText = conhece + " / " + pessoas.length;

      const labelsEmp = empresas.map(e => e.empresa_nome || 'Empresa');
      const energia = empresas.map(e => { const n = Number(e.energia_kwh); return isNaN(n) ? 0 : n; });

      const ctxEmp = document.getElementById('graficoEmpresas').getContext('2d');
      if(window.grafEmpresas) window.grafEmpresas.destroy();
      window.grafEmpresas = new Chart(ctxEmp, {
        type: 'bar',
        data: { labels: labelsEmp, datasets: [{ label: 'Consumo (kWh)', data: energia, backgroundColor: ['#198754','#28a745','#45c06f'], borderColor: '#0f5132', borderWidth: 1 }] },
        options: { responsive: true, plugins: { tooltip: { callbacks: { label: ctx => ctx.parsed.y>0 ? `${ctx.parsed.y.toLocaleString()} kWh` : 'N√£o informado' } }, title: { display:true, text:'Consumo de energia ‚Äî empresas' } }, scales:{ y:{ beginAtZero:true } } }
      });

      const ctxP = document.getElementById('graficoPessoas').getContext('2d');
      if(window.grafPessoas) window.grafPessoas.destroy();
      window.grafPessoas = new Chart(ctxP, {
        type: 'doughnut',
        data: { labels:['Conhecem','N√£o conhecem'], datasets:[{ data:[conhece,pessoas.length - conhece], backgroundColor:['#28a745','#c3e6cb'] }] },
        options: { responsive:true, plugins:{ tooltip:{ callbacks:{ label: ctx=>`${ctx.label}: ${ctx.parsed} (${Math.round((ctx.parsed/pessoas.length)*100)}%)` } }, title:{ display:true, text:'Conscientiza√ß√£o sobre Cloud Sustent√°vel (pessoas)' } } }
      });

      const descarteMap = {};
      pessoas.forEach(p => { const key = p.descarte && p.descarte.trim() ? p.descarte.trim() : 'N√£o informado'; descarteMap[key] = (descarteMap[key]||0)+1; });
      const labelsDesc = Object.keys(descarteMap), dataDesc = labelsDesc.map(k => descarteMap[k]);
      const elDesc = document.getElementById('graficoDescarte').getContext('2d');
      if(window.grafDescarte) window.grafDescarte.destroy();
      window.grafDescarte = new Chart(elDesc, { type:'bar', data:{ labels:labelsDesc, datasets:[{ label:'N√∫mero de respostas', data:dataDesc }] }, options:{ responsive:true, plugins:{ title:{ display:true, text:'Formas de descarte (p√∫blico)' } } } });

      const tabela = document.getElementById('resumoEmpresas'); tabela.innerHTML='';
      const thead = document.createElement('thead'); thead.innerHTML='<tr><th>Empresa</th><th>kWh</th><th>Virtualiza√ß√£o</th><th>Medidas</th><th>Autorizou</th></tr>';
      tabela.appendChild(thead);
      const tbody = document.createElement('tbody');
      empresas.forEach(e => { const tr=document.createElement('tr'); tr.innerHTML=`<td>${e.empresa_nome||''}</td><td>${formatoValor(e.energia_kwh)}</td><td>${e.virtualizacao||''}</td><td>${e.medidas_eficiencia||''}</td><td>${e.autorizacao||''}</td>`; tbody.appendChild(tr); });
      tabela.appendChild(tbody);

      const tableRaw = document.getElementById('tableRaw'); if(tableRaw){ tableRaw.innerHTML=''; const cols=Object.keys(rows[0]||{}); const thead2=document.createElement('thead'); thead2.innerHTML='<tr>'+cols.map(c=>`<th>${c}</th>`).join('')+'</tr>'; tableRaw.appendChild(thead2); const tbody2=document.createElement('tbody'); rows.forEach(r=>{ const tr=document.createElement('tr'); tr.innerHTML=cols.map(c=>`<td>${r[c]||''}</td>`).join(''); tbody2.appendChild(tr); }); tableRaw.appendChild(tbody2); }
    }

    initDashboardFromCSVString(exemploCSV);

    document.getElementById('toggleRawBtn').addEventListener('click',()=>{ const raw=document.getElementById('rawData'); raw.style.display=raw.style.display==='none'?'block':'none'; });

    document.getElementById('downloadCsvBtn').addEventListener('click',()=>{
      const blob=new Blob([exemploCSV],{ type:'text/csv;charset=utf-8;' });
      const url=URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='dados_coleta_exemplo.csv'; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
